CREATE DATABASE JOINNUS
GO
USE JOINNUS
GO

CREATE TABLE TB_USUARIO(
ID_USU INT NOT NULL,
U_NOMBRES VARCHAR(50) NULL,
U_APELLIDOS VARCHAR(50)  NULL,
U_CORREO VARCHAR(50) NULL,
U_CONTRA VARCHAR(20) NULL,
ID_GEN INT NOT NULL,
ID_PAIS INT NOT NULL,
CONSTRAINT USU_PK PRIMARY KEY (ID_USU) 
)
CREATE TABLE PAIS(
ID_PAIS  INT NOT NULL ,
PAIS VARCHAR(50)  NULL,
CONSTRAINT PAIS_PK PRIMARY KEY (ID_PAIS)
)
CREATE TABLE CIUDAD(
ID_CIU  INT NOT NULL ,
CIUDAD VARCHAR(50)  NULL,
ID_PAIS  INT NOT NULL ,
CONSTRAINT CIU_PK PRIMARY KEY (ID_CIU)
) 
CREATE TABLE GENERO(
ID_GEN  INT NOT NULL ,
GENERO VARCHAR(20)  NULL,
CONSTRAINT GEN_PK PRIMARY KEY (ID_GEN)
)
CREATE TABLE EVENTO(
ID_EV  INT NOT NULL ,
EV_NOMBRE VARCHAR(50)  NULL,
EV_DESC VARCHAR(150)  NULL,
EV_INFO VARCHAR(150)  NULL,
EV_FECINICIO DATE NULL,
EV_FECFIN DATE  NULL,
EV_IMG VarBinary(max) NULL ,
EV_VIDEO VarBinary(max) NULL,
EV_IMGTICKET VarBinary(max)  NULL,
EV_DIREC VARCHAR(50)  NULL,
EV_REF VARCHAR(100)  NULL,
EV_ENCU VARCHAR(50)  NULL,
ID_CATEG INT NOT NULL, 
ID_USU INT NOT NULL, 
ID_CIU INT NOT NULL, 
CONSTRAINT EV_PK PRIMARY KEY (ID_EV)
)
CREATE TABLE CATEGORIA(
ID_CAT INT NOT NULL,
CAT_DESC VARCHAR(50) NULL,
CONSTRAINT CAT_PK PRIMARY KEY (ID_CAT)
)
CREATE TABLE ENTRADA(
ID_ENT INT NOT NULL,
EN_NOMBRE VARCHAR(50) NULL,
EN_CANT INT NULL,
EN_PRECIO FLOAT NULL,
EN_DESC VARCHAR(150)  NULL,
EN_ACTIVADO BIT  NULL,
ID_EVEN INT NOT  NULL,
ID_CANTMIN INT NOT NULL,
ID_CANTMAX INT NOT NULL,
ID_CANTXUSU INT NOT NULL,
ID_FINVENTA INT NOT NULL,
CONSTRAINT EN_PK PRIMARY KEY (ID_ENT)
)
CREATE TABLE FINVENTA (
ID_FINVENTA INT NOT NULL,
DESC_FINVENTA VARCHAR(50) NULL,
CONSTRAINT  FINVENTA_PK PRIMARY KEY (ID_FINVENTA)
)

CREATE TABLE CANTMIN (
ID_CANTMIN INT NOT NULL,
DESC_CANT INT NULL,
CONSTRAINT CANTMIN_PK PRIMARY KEY (ID_CANTMIN)
)
CREATE TABLE CANTMAX (
ID_CANTMAX INT NOT NULL,
DESC_CANTMAX INT NULL,
CONSTRAINT CANTMAX_PK PRIMARY KEY (ID_CANTMAX)
)
CREATE TABLE CANTXUSU(
ID_CANTXUSU INT NOT NULL,
DESC_CANTXUSU INT NULL,
CONSTRAINT CANTXUSU_PK PRIMARY KEY (ID_CANTXUSU)
)
CREATE TABLE TICKET(
ID_TK INT NOT NULL,
ID_ENT INT NOT NULL,
ID_COMP INT NOT NULL,
CONSTRAINT TK_PK PRIMARY KEY (ID_TK)
)
CREATE TABLE COMPRA(
ID_COMP INT NOT NULL,
ID_USU INT NOT NULL,
ID_METPAGO INT NOT NULL,
CANT_TICKETS INT NULL,
PRECIO FLOAT  NULL,
CONSTRAINT COMP_PK PRIMARY KEY (ID_COMP)
)
CREATE TABLE METPAGO(
ID_METPAGO INT NOT NULL,
DESC_METPAGO VARCHAR(50) NULL,
CONSTRAINT MET_PK PRIMARY KEY (ID_METPAGO)
)
CREATE TABLE BOLETA(
ID_BOL INT NOT NULL,
BOL_CODPAGO INT  NULL,
BOL_PRECTOTAL FLOAT  NULL,
ID_COMP INT NOT NULL,
CONSTRAINT BOL_PK PRIMARY KEY(ID_BOL)
)
ALTER TABLE TB_USUARIO ADD
CONSTRAINT FK_USUPA FOREIGN KEY (ID_PAIS)
 REFERENCES PAIS(ID_PAIS)

 ALTER TABLE TB_USUARIO ADD
CONSTRAINT FK_USUGEN FOREIGN KEY (ID_GEN)
 REFERENCES GENERO(ID_GEN)
 
 ALTER TABLE EVENTO ADD
CONSTRAINT FK_EVEUSU FOREIGN KEY (ID_USU)
 REFERENCES TB_USUARIO(ID_USU)

  ALTER TABLE COMPRA ADD
CONSTRAINT FK_COMUSU FOREIGN KEY (ID_USU)
 REFERENCES TB_USUARIO(ID_USU)

  ALTER TABLE EVENTO ADD
CONSTRAINT FK_EVECIU FOREIGN KEY (ID_CIU)
 REFERENCES CIUDAD(ID_CIU)

  ALTER TABLE EVENTO ADD
CONSTRAINT FK_EVECAT FOREIGN KEY (ID_CATEG)
 REFERENCES CATEGORIA(ID_CAT)

  ALTER TABLE ENTRADA ADD
CONSTRAINT FK_ENTEVE FOREIGN KEY (ID_EVEN)
 REFERENCES EVENTO(ID_EV)

  ALTER TABLE TICKET ADD
CONSTRAINT FK_TKENT FOREIGN KEY (ID_ENT)
 REFERENCES ENTRADA(ID_ENT)

  ALTER TABLE ENTRADA ADD
CONSTRAINT FK_ENTMIN FOREIGN KEY (ID_CANTMIN)
 REFERENCES CANTMIN(ID_CANTMIN)

 ALTER TABLE ENTRADA ADD
CONSTRAINT FK_ENTMAX FOREIGN KEY (ID_CANTMAX)
 REFERENCES CANTMAX(ID_CANTMAX)

 ALTER TABLE ENTRADA ADD
CONSTRAINT FK_ENTCANTXUSU FOREIGN KEY (ID_CANTXUSU)
 REFERENCES CANTXUSU(ID_CANTXUSU)

  ALTER TABLE TICKET ADD
CONSTRAINT FK_TKCOM FOREIGN KEY (ID_COMP)
 REFERENCES COMPRA(ID_COMP)

   ALTER TABLE COMPRA ADD
CONSTRAINT FK_COMMETPAGO FOREIGN KEY (ID_METPAGO)
 REFERENCES METPAGO(ID_METPAGO)

    ALTER TABLE BOLETA ADD
CONSTRAINT FK_BOLCOM FOREIGN KEY (ID_COMP)
 REFERENCES COMPRA(ID_COMP)

  ALTER TABLE CIUDAD ADD
CONSTRAINT FK_CIUPAIS FOREIGN KEY (ID_PAIS)
 REFERENCES PAIS(ID_PAIS)

ALTER TABLE ENTRADA ADD
CONSTRAINT FK_FINENT FOREIGN KEY (ID_FINVENTA)
 REFERENCES FINVENTA(ID_FINVENTA)
